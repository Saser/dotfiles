- name: Import platform tasks (macOS)
  import_tasks: macos.yml
  when: ansible_distribution == 'MacOSX'

- name: Set $ZPLUG_HOME environment variable
  lineinfile:
    path: '{{ envensure_entries }}'
    line: 'export ZPLUG_HOME="{{ zsh_zplug_home }}"'
    create: true

- name: Link zplug directory to $ZPLUG_HOME
  file:
    src: '{{ role_path }}/files/zplug'
    dest: '{{ zsh_zplug_home }}'
    state: link

- name: Link plugins directory to its place
  file:
    src: '{{ role_path }}/files/zshplugins'
    dest: '{{ zsh_zshplugins }}'
    state: link

- name: Set $ZSHPLUGINS environment variable
  lineinfile:
    path: '{{ envensure_entries }}'
    line: 'export ZSHPLUGINS="{{ zsh_zshplugins }}"'
    create: true

- name: Ensure startup files are in place
  loop:
    - '.prompt'
    - '.zshrc'
  file:
    src: '{{ role_path }}/files/{{ item }}'
    dest: '{{ ansible_env.HOME }}/{{ item }}'
    state: link
